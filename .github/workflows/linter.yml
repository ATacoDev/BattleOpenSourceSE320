name: Lint Code Base

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]

jobs:
  build:
    name: Lint Code Base
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      
      - name: Lint C++ Files
        run: |
          find . -type f -name '*.cpp' -o -name '*.h' | while read file; do
            echo "Linting $file"
            # Check for tabs
            grep -P "\t" "$file" && echo "Tabs found in $file" && exit 1
            # Check for line length
            awk 'length($0) > 80 { print FILENAME ":" FNR ": line exceeds 80 characters"; exit 1 }' "$file"
            # Check if file ends with a newline
            tail -c1 "$file" | read -r _ || echo "$file does not end with a newline" && exit 1
          done