name: Lint Code Base

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]

jobs:
  build:
    name: Lint Code Base
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      
      - name: Lint C++ Files
        run: |
          find . -type f \( -name '*.cpp' -o -name '*.h' \) | while read file; do
            echo "Linting $file"
            # Check for tabs
            if grep -P "\t" "$file"; then
              echo "Error: Tabs found in $file"
              exit 1
            fi
            # Check for line length
            if awk 'length($0) > 80 { print FILENAME ":" FNR ": line exceeds 80 characters"; exit 1 }' "$file"; then
              exit 1
            fi
            # Check if file ends with a newline
            if [ "$(tail -c1 "$file" | wc -l)" -eq "0" ]; then
              echo "Error: $file does not end with a newline"
              exit 1
            fi
          done